/*! For license information please see createVerticesFromQuantizedTerrainMesh.js.LICENSE.txt */
import{a as Ct,b as vt}from"./chunk-AZ3SWEDV.js";import{a as Mt}from"./chunk-PWAJ3RAI.js";import{a as z}from"./chunk-R3AL5FUL.js";import"./chunk-CXNPIJLB.js";import{a as Wt}from"./chunk-KSZ5EBRB.js";import{a as X}from"./chunk-NNHN6WUY.js";import"./chunk-BKSIEBAA.js";import{b as U,g as bt,h as At}from"./chunk-YWRPWWKI.js";import"./chunk-VTVHUB7E.js";import{a as P,b as wt,c as lt,d as pt}from"./chunk-JMSSU44E.js";import{a as f}from"./chunk-4UYSGV57.js";import"./chunk-ANLJ4KBN.js";import"./chunk-ID6SFQTL.js";import"./chunk-VLPNAR64.js";import{a as m}from"./chunk-GE5NEIZC.js";import{e as w}from"./chunk-35CVRQTC.js";function T(){m.throwInstantiationError()}Object.defineProperties(T.prototype,{errorEvent:{get:m.throwInstantiationError},credit:{get:m.throwInstantiationError},tilingScheme:{get:m.throwInstantiationError},hasWaterMask:{get:m.throwInstantiationError},hasVertexNormals:{get:m.throwInstantiationError},availability:{get:m.throwInstantiationError}});var Ot=[];T.getRegularGridIndices=function(t,e){if(t*e>=f.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");let r=Ot[t];w(r)||(Ot[t]=r=[]);let n=r[e];return w(n)||(n=t*e<f.SIXTY_FOUR_KILOBYTES?r[e]=new Uint16Array((t-1)*(e-1)*6):r[e]=new Uint32Array((t-1)*(e-1)*6),Pt(t,e,n,0)),n};var Gt=[];T.getRegularGridIndicesAndEdgeIndices=function(t,e){if(t*e>=f.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");let r=Gt[t];w(r)||(Gt[t]=r=[]);let n=r[e];if(!w(n)){let i=T.getRegularGridIndices(t,e),o=Lt(t,e),a=o.westIndicesSouthToNorth,s=o.southIndicesEastToWest,h=o.eastIndicesNorthToSouth,u=o.northIndicesWestToEast;n=r[e]={indices:i,westIndicesSouthToNorth:a,southIndicesEastToWest:s,eastIndicesNorthToSouth:h,northIndicesWestToEast:u}}return n};var kt=[];function Lt(t,e){let r,n=new Array(e),i=new Array(t),o=new Array(e),a=new Array(t);for(r=0;r<t;++r)a[r]=r,i[r]=t*e-1-r;for(r=0;r<e;++r)o[r]=(r+1)*t-1,n[r]=(e-r-1)*t;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function Pt(t,e,r,n){let i=0;for(let o=0;o<e-1;++o){for(let e=0;e<t-1;++e){let e=i,o=e+t,a=o+1,s=e+1;r[n++]=e,r[n++]=o,r[n++]=s,r[n++]=s,r[n++]=o,r[n++]=a,++i}++i}}function Z(t,e,r,n){let i=t[0],o=t.length;for(let a=1;a<o;++a){let o=t[a];r[n++]=i,r[n++]=o,r[n++]=e,r[n++]=e,r[n++]=o,r[n++]=e+1,i=o,++e}return n}T.getRegularGridAndSkirtIndicesAndEdgeIndices=function(t,e){if(t*e>=f.FOUR_GIGABYTES)throw new m("The total number of vertices (width * height) must be less than 4,294,967,296.");let r=kt[t];w(r)||(kt[t]=r=[]);let n=r[e];if(!w(n)){let i=t*e,o=(t-1)*(e-1)*6,a=2*t+2*e,s=i+a,h=o+6*Math.max(0,a-4),u=Lt(t,e),c=u.westIndicesSouthToNorth,l=u.southIndicesEastToWest,I=u.eastIndicesNorthToSouth,d=u.northIndicesWestToEast,m=X.createTypedArray(s,h);Pt(t,e,m,0),T.addSkirtIndices(c,l,I,d,i,m,o),n=r[e]={indices:m,westIndicesSouthToNorth:c,southIndicesEastToWest:l,eastIndicesNorthToSouth:I,northIndicesWestToEast:d,indexCountWithoutSkirts:o}}return n},T.addSkirtIndices=function(t,e,r,n,i,o,a){let s=i;a=Z(t,s,o,a),s+=t.length,a=Z(e,s,o,a),s+=e.length,a=Z(r,s,o,a),s+=r.length,Z(n,s,o,a)},T.heightmapTerrainQuality=.25,T.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(t,e,r){return 2*t.maximumRadius*Math.PI*T.heightmapTerrainQuality/(e*r)},T.prototype.requestTileGeometry=m.throwInstantiationError,T.prototype.getLevelMaximumGeometricError=m.throwInstantiationError,T.prototype.getTileDataAvailable=m.throwInstantiationError,T.prototype.loadTileDataAvailability=m.throwInstantiationError;var Vt=T,ht=32767,D=new P,Xt=new P,Zt=new P,u=new wt,Y=new lt;function Jt(t,e){let r,n,i=t.quantizedVertices,o=i.length/3,a=t.octEncodedNormals,s=t.westIndices.length+t.eastIndices.length+t.southIndices.length+t.northIndices.length,h=t.includeWebMercatorT,c=t.exaggeration,l=t.exaggerationRelativeHeight,I=1!==c,d=At.clone(t.rectangle),m=d.west,T=d.south,g=d.east,N=d.north,p=pt.clone(t.ellipsoid),E=t.minimumHeight,S=t.maximumHeight,y=t.relativeToCenter,A=bt.eastNorthUpToFixedFrame(y,p),b=U.inverseTransformation(A,new U);h&&(r=z.geodeticLatitudeToMercatorAngle(T),n=1/(z.geodeticLatitudeToMercatorAngle(N)-r));let k=i.subarray(0,o),x=i.subarray(o,2*o),W=i.subarray(2*o,3*o),G=w(a),M=new Array(o),v=new Array(o),F=new Array(o),V=h?new Array(o):[],_=I?new Array(o):[],j=Xt;j.x=Number.POSITIVE_INFINITY,j.y=Number.POSITIVE_INFINITY,j.z=Number.POSITIVE_INFINITY;let B=Zt;B.x=Number.NEGATIVE_INFINITY,B.y=Number.NEGATIVE_INFINITY,B.z=Number.NEGATIVE_INFINITY;let C=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,O=Number.POSITIVE_INFINITY,L=Number.NEGATIVE_INFINITY;for(let t=0;t<o;++t){let e=k[t],i=x[t],o=e/ht,a=i/ht,s=f.lerp(E,S,W[t]/ht);u.longitude=f.lerp(m,g,o),u.latitude=f.lerp(T,N,a),u.height=s,C=Math.min(u.longitude,C),H=Math.max(u.longitude,H),O=Math.min(u.latitude,O),L=Math.max(u.latitude,L);let c=p.cartographicToCartesian(u);M[t]=new lt(o,a),v[t]=s,F[t]=c,h&&(V[t]=(z.geodeticLatitudeToMercatorAngle(u.latitude)-r)*n),I&&(_[t]=p.geodeticSurfaceNormal(c)),U.multiplyByPoint(b,c,D),P.minimumByComponent(D,j,j),P.maximumByComponent(D,B,B)}let R,Z=tt(t.westIndices,(function(t,e){return M[t].y-M[e].y})),K=tt(t.eastIndices,(function(t,e){return M[e].y-M[t].y})),Q=tt(t.southIndices,(function(t,e){return M[e].x-M[t].x})),q=tt(t.northIndices,(function(t,e){return M[t].x-M[e].x}));E<0&&(R=new Ct(p).computeHorizonCullingPointPossiblyUnderEllipsoid(y,F,E));let et=E;et=Math.min(et,J(t.westIndices,t.westSkirtHeight,v,M,d,p,b,j,B)),et=Math.min(et,J(t.southIndices,t.southSkirtHeight,v,M,d,p,b,j,B)),et=Math.min(et,J(t.eastIndices,t.eastSkirtHeight,v,M,d,p,b,j,B)),et=Math.min(et,J(t.northIndices,t.northSkirtHeight,v,M,d,p,b,j,B));let rt=new Wt(j,B,y),nt=new vt(y,rt,et,S,A,G,h,I,c,l),it=nt.stride,ot=new Float32Array(o*it+s*it),at=0;for(let t=0;t<o;++t){if(G){let e=2*t;Y.x=a[e],Y.y=a[e+1]}at=nt.encode(ot,at,F[t],M[t],v[t],Y,V[t],_[t])}let st=Math.max(0,2*(s-4)),ut=t.indices.length+3*st,ct=X.createTypedArray(o+s,ut);ct.set(t.indices,0);let It=1e-4,dt=(H-C)*It,mt=(L-O)*It,Tt=-dt,gt=dt,ft=mt,wt=-mt,Nt=o*it;return $(ot,Nt,Z,nt,v,M,a,p,d,t.westSkirtHeight,r,n,Tt,0),Nt+=t.westIndices.length*it,$(ot,Nt,Q,nt,v,M,a,p,d,t.southSkirtHeight,r,n,0,wt),Nt+=t.southIndices.length*it,$(ot,Nt,K,nt,v,M,a,p,d,t.eastSkirtHeight,r,n,gt,0),Nt+=t.eastIndices.length*it,$(ot,Nt,q,nt,v,M,a,p,d,t.northSkirtHeight,r,n,0,ft),Vt.addSkirtIndices(Z,Q,K,q,o,ct,t.indices.length),e.push(ot.buffer,ct.buffer),{vertices:ot.buffer,indices:ct.buffer,westIndicesSouthToNorth:Z,southIndicesEastToWest:Q,eastIndicesNorthToSouth:K,northIndicesWestToEast:q,vertexStride:it,center:y,minimumHeight:E,maximumHeight:S,occludeePointInScaledSpace:R,encoding:nt,indexCountWithoutSkirts:t.indices.length}}function J(t,e,r,n,i,o,a,s,h){let c=Number.POSITIVE_INFINITY,l=i.north,I=i.south,d=i.east,m=i.west;d<m&&(d+=f.TWO_PI);let T=t.length;for(let i=0;i<T;++i){let T=t[i],g=r[T],w=n[T];u.longitude=f.lerp(m,d,w.x),u.latitude=f.lerp(I,l,w.y),u.height=g-e;let N=o.cartographicToCartesian(u,D);U.multiplyByPoint(a,N,N),P.minimumByComponent(N,s,s),P.maximumByComponent(N,h,h),c=Math.min(c,u.height)}return c}function $(t,e,r,n,i,o,a,s,h,c,l,I,d,m){let T=w(a),g=h.north,N=h.south,p=h.east,E=h.west;p<E&&(p+=f.TWO_PI);let S=r.length;for(let h=0;h<S;++h){let w=r[h],S=i[w],y=o[w];u.longitude=f.lerp(E,p,y.x)+d,u.latitude=f.lerp(N,g,y.y)+m,u.height=S-c;let A,b,k=s.cartographicToCartesian(u,D);if(T){let t=2*w;Y.x=a[t],Y.y=a[t+1]}n.hasWebMercatorT&&(A=(z.geodeticLatitudeToMercatorAngle(u.latitude)-l)*I),n.hasGeodeticSurfaceNormals&&(b=s.geodeticSurfaceNormal(k)),e=n.encode(t,e,k,y,u.height,Y,A,b)}}function tt(t,e){let r;return"function"==typeof t.slice&&(r=t.slice(),"function"!=typeof r.sort&&(r=void 0)),w(r)||(r=Array.prototype.slice.call(t)),r.sort(e),r}var Se=Mt(Jt);export{Se as default};
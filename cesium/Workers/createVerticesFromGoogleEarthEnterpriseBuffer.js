/*! For license information please see createVerticesFromGoogleEarthEnterpriseBuffer.js.LICENSE.txt */
import{a as Gt,b as Xt}from"./chunk-AZ3SWEDV.js";import{a as kt}from"./chunk-PWAJ3RAI.js";import{a as lt}from"./chunk-R3AL5FUL.js";import{a as Dt}from"./chunk-O3CFQFRB.js";import"./chunk-CXNPIJLB.js";import"./chunk-FNJKWSPR.js";import{a as qt}from"./chunk-KSZ5EBRB.js";import"./chunk-V3DSE3OK.js";import"./chunk-FMRIJYNG.js";import{d as Lt}from"./chunk-BKSIEBAA.js";import{b as $,g as Ot,h as zt}from"./chunk-YWRPWWKI.js";import"./chunk-VTVHUB7E.js";import{a as P,b as N,c as wt,d as Ht}from"./chunk-JMSSU44E.js";import{a as r}from"./chunk-4UYSGV57.js";import"./chunk-ANLJ4KBN.js";import{a as Vt}from"./chunk-ID6SFQTL.js";import{a as Ut}from"./chunk-VLPNAR64.js";import"./chunk-GE5NEIZC.js";import{e as ht}from"./chunk-35CVRQTC.js";var te=Uint16Array.BYTES_PER_ELEMENT,mt=Int32Array.BYTES_PER_ELEMENT,Pt=Uint32Array.BYTES_PER_ELEMENT,ee=Float32Array.BYTES_PER_ELEMENT,H=Float64Array.BYTES_PER_ELEMENT;function tt(t,e,n){n=Ut(n,r);let i=t.length;for(let o=0;o<i;++o)if(n.equalsEpsilon(t[o],e,r.EPSILON12))return o;return-1}function oe(t,e){t.ellipsoid=Ht.clone(t.ellipsoid),t.rectangle=zt.clone(t.rectangle);let n=se(t.buffer,t.relativeToCenter,t.ellipsoid,t.rectangle,t.nativeRectangle,t.exaggeration,t.exaggerationRelativeHeight,t.skirtHeight,t.includeWebMercatorT,t.negativeAltitudeExponentBias,t.negativeElevationThreshold),i=n.vertices;e.push(i.buffer);let r=n.indices;return e.push(r.buffer),{vertices:i.buffer,indices:r.buffer,numberOfAttributes:n.encoding.stride,minimumHeight:n.minimumHeight,maximumHeight:n.maximumHeight,boundingSphere3D:n.boundingSphere3D,orientedBoundingBox:n.orientedBoundingBox,occludeePointInScaledSpace:n.occludeePointInScaledSpace,encoding:n.encoding,vertexCountWithoutSkirts:n.vertexCountWithoutSkirts,indexCountWithoutSkirts:n.indexCountWithoutSkirts,westIndicesSouthToNorth:n.westIndicesSouthToNorth,southIndicesEastToWest:n.southIndicesEastToWest,eastIndicesNorthToSouth:n.eastIndicesNorthToSouth,northIndicesWestToEast:n.northIndicesWestToEast}}var u=new N,G=new P,ne=new P,ie=new P,re=new $;function se(t,e,n,i,o,a,s,l,h,c,d){let m,g,p,I,E,f;ht(i)?(m=i.west,g=i.south,p=i.east,I=i.north,E=i.width,f=i.height):(m=r.toRadians(o.west),g=r.toRadians(o.south),p=r.toRadians(o.east),I=r.toRadians(o.north),E=r.toRadians(i.width),f=r.toRadians(i.height));let T,S,x=[g,I],w=[m,p],A=Ot.eastNorthUpToFixedFrame(e,n),R=$.inverseTransformation(A,re);h&&(T=lt.geodeticLatitudeToMercatorAngle(g),S=1/(lt.geodeticLatitudeToMercatorAngle(I)-T));let k=1!==a,B=new DataView(t),b=Number.POSITIVE_INFINITY,F=Number.NEGATIVE_INFINITY,y=ne;y.x=Number.POSITIVE_INFINITY,y.y=Number.POSITIVE_INFINITY,y.z=Number.POSITIVE_INFINITY;let v=ie;v.x=Number.NEGATIVE_INFINITY,v.y=Number.NEGATIVE_INFINITY,v.z=Number.NEGATIVE_INFINITY;let M,_,W=0,V=0,j=0;for(_=0;_<4;++_){let t=W;M=B.getUint32(t,!0),t+=Pt;let e=r.toRadians(180*B.getFloat64(t,!0));t+=H,-1===tt(w,e)&&w.push(e);let n=r.toRadians(180*B.getFloat64(t,!0));t+=H,-1===tt(x,n)&&x.push(n),t+=2*H;let i=B.getInt32(t,!0);t+=mt,V+=i,i=B.getInt32(t,!0),j+=3*i,W+=M+Pt}let C=[],U=[],L=new Array(V),Y=new Array(V),O=new Array(V),D=h?new Array(V):[],J=k?new Array(V):[],K=new Array(j),z=[],q=[],Q=[],X=[],Z=0,et=0;for(W=0,_=0;_<4;++_){M=B.getUint32(W,!0),W+=Pt;let t=W,e=r.toRadians(180*B.getFloat64(W,!0));W+=H;let i=r.toRadians(180*B.getFloat64(W,!0));W+=H;let o=r.toRadians(180*B.getFloat64(W,!0)),a=.5*o;W+=H;let s=r.toRadians(180*B.getFloat64(W,!0)),l=.5*s;W+=H;let E=B.getInt32(W,!0);W+=mt;let f=B.getInt32(W,!0);W+=mt,W+=mt;let A=new Array(E);for(let t=0;t<E;++t){let E=e+B.getUint8(W++)*o;u.longitude=E;let f=i+B.getUint8(W++)*s;u.latitude=f;let M=B.getFloat32(W,!0);if(W+=ee,0!==M&&M<d&&(M*=-Math.pow(2,c)),M*=6371010,u.height=M,-1!==tt(w,E)||-1!==tt(x,f)){let e=tt(C,u,N);if(-1!==e){A[t]=U[e];continue}C.push(N.clone(u)),U.push(Z)}A[t]=Z,Math.abs(E-m)<a?z.push({index:Z,cartographic:N.clone(u)}):Math.abs(E-p)<a?Q.push({index:Z,cartographic:N.clone(u)}):Math.abs(f-g)<l?q.push({index:Z,cartographic:N.clone(u)}):Math.abs(f-I)<l&&X.push({index:Z,cartographic:N.clone(u)}),b=Math.min(M,b),F=Math.max(M,F),O[Z]=M;let H=n.cartographicToCartesian(u);if(L[Z]=H,h&&(D[Z]=(lt.geodeticLatitudeToMercatorAngle(f)-T)*S),k){let t=n.geodeticSurfaceNormal(H);J[Z]=t}$.multiplyByPoint(R,H,G),P.minimumByComponent(G,y,y),P.maximumByComponent(G,v,v);let _=(E-m)/(p-m);_=r.clamp(_,0,1);let V=(f-g)/(I-g);V=r.clamp(V,0,1),Y[Z]=new wt(_,V),++Z}let _=3*f;for(let t=0;t<_;++t,++et)K[et]=A[B.getUint16(W,!0)],W+=te;if(M!==W-t)throw new Vt("Invalid terrain tile.")}L.length=Z,Y.length=Z,O.length=Z,h&&(D.length=Z),k&&(J.length=Z);let nt=Z,it=et,rt={hMin:b,lastBorderPoint:void 0,skirtHeight:l,toENU:R,ellipsoid:n,minimum:y,maximum:v};z.sort((function(t,e){return e.cartographic.latitude-t.cartographic.latitude})),q.sort((function(t,e){return t.cartographic.longitude-e.cartographic.longitude})),Q.sort((function(t,e){return t.cartographic.latitude-e.cartographic.latitude})),X.sort((function(t,e){return e.cartographic.longitude-t.cartographic.longitude}));let ot=1e-5;if(gt(L,O,Y,D,J,K,rt,z,-ot*E,!0,-ot*f),gt(L,O,Y,D,J,K,rt,q,-ot*f,!1),gt(L,O,Y,D,J,K,rt,Q,ot*E,!0,ot*f),gt(L,O,Y,D,J,K,rt,X,ot*f,!1),z.length>0&&X.length>0){let t=z[0].index,e=nt,n=X[X.length-1].index,i=L.length-1;K.push(n,i,e,e,t,n)}V=L.length;let at,ut=Lt.fromPoints(L);ht(i)&&(at=Dt.fromRectangle(i,b,F,n));let st=new Gt(n).computeHorizonCullingPointPossiblyUnderEllipsoid(e,L,b),ct=new qt(y,v,e),dt=new Xt(e,ct,rt.hMin,F,A,!1,h,k,a,s),pt=new Float32Array(V*dt.stride),It=0;for(let t=0;t<V;++t)It=dt.encode(pt,It,L[t],Y[t],O[t],void 0,D[t],J[t]);let Et=z.map((function(t){return t.index})).reverse(),Nt=q.map((function(t){return t.index})).reverse(),ft=Q.map((function(t){return t.index})).reverse(),Tt=X.map((function(t){return t.index})).reverse();return Nt.unshift(ft[ft.length-1]),Nt.push(Et[0]),Tt.unshift(Et[Et.length-1]),Tt.push(ft[0]),{vertices:pt,indices:new Uint16Array(K),maximumHeight:F,minimumHeight:b,encoding:dt,boundingSphere3D:ut,orientedBoundingBox:at,occludeePointInScaledSpace:st,vertexCountWithoutSkirts:nt,indexCountWithoutSkirts:it,westIndicesSouthToNorth:Et,southIndicesEastToWest:Nt,eastIndicesNorthToSouth:ft,northIndicesWestToEast:Tt}}function gt(t,e,n,i,o,a,s,l,h,c,d){let m=l.length;for(let g=0;g<m;++g){let p=l[g],I=p.cartographic,E=p.index,f=t.length,T=I.longitude,S=I.latitude;S=r.clamp(S,-r.PI_OVER_TWO,r.PI_OVER_TWO);let x=I.height-s.skirtHeight;s.hMin=Math.min(s.hMin,x),N.fromRadians(T,S,x,u),c&&(u.longitude+=h),c?g===m-1?u.latitude+=d:0===g&&(u.latitude-=d):u.latitude+=h;let w=s.ellipsoid.cartographicToCartesian(u);t.push(w),e.push(x),n.push(wt.clone(n[E])),i.length>0&&i.push(i[E]),o.length>0&&o.push(o[E]),$.multiplyByPoint(s.toENU,w,G);let A=s.minimum,R=s.maximum;P.minimumByComponent(G,A,A),P.maximumByComponent(G,R,R);let k=s.lastBorderPoint;if(ht(k)){let t=k.index;a.push(t,f-1,f,f,E,t)}s.lastBorderPoint=p}}var Ae=kt(oe);export{Ae as default};